# vim:set foldmethod=marker foldlevel=0:
# i3の設定ファイル

# キーマッピング・マウス設定 {{{
# モディファイヤ{{{
# WinキーをModに設定
set $mod Mod4

# `Mouse + $mod` でウィンドウ移動など
floating_modifier $mod
# }}}
# アプリ{{{

bindsym $mod+Return exec i3-sensible-terminal
bindsym $mod+d exec rofi -show run

# reload the configuration file
bindsym $mod+Shift+c reload
# restart i3 inplace (preserves your layout/session, can be used to upgrade i3)
bindsym $mod+Shift+r restart
# exit i3 (logs you out of your X session)
bindsym $mod+Shift+e exec "i3-nagbar -t warning -m 'You pressed the exit shortcut. Do you really want to exit i3? This will end your X session.' -b 'Yes, exit i3' 'i3-msg exit'"

# キーマップ。なぜかspaceのsを大文字にするとうまく行かない
# アプリでのキーバインドとのバッティングのため変更
# bindsym ctrl+space exec rofi -show window
bindsym $mod+i exec rofi -show window

# チートシート閲覧用
bindsym $mod+z exec google-chrome `find -L ~/memo -name '*.md' -not -path '*/.git/*'| rofi -dmenu -p 'cheetsheet'`

# 自作スクリプトを実行
bindsym $mod+Shift+z exec eval `find -L ~/memo/dotfiles/scripts/gui/ -type f| rofi -dmenu -p 'run'`

bindsym XF86AudioRaiseVolume exec --no-startup-id pactl set-sink-volume 0 +5%
bindsym XF86AudioLowerVolume exec --no-startup-id pactl set-sink-volume 0 -5%
bindsym Ctrl+Up exec --no-startup-id pactl set-sink-volume 0 +5%
bindsym Ctrl+Down exec --no-startup-id pactl set-sink-volume 0 -5%

# put the system to sleep
bindsym $mod+Shift+s exec systemctl suspend
# スクリーンショット設定。scrotとxclipが必要
# Multi-screen screenshots with scrot
bindsym --release Print exec scrot 'screenshot_%Y%m%d_%H%M%S.png' \
  -e 'mkdir -p ~/Pictures/screenshots && \
    mv $f ~/Pictures/screenshots && \
    xclip -selection clipboard -t image/png \
      -i ~/Pictures/screenshots/`ls -1 -t ~/Pictures/screenshots | head -1` \
    | notify-send "Saved $f" -t 1500' # All screens

# OSX-like area selection screenshots
bindsym --release Shift+Print exec notify-send 'Plese select window or rectangle area' -t 1000 && \
  scrot -s 'screenshot_%Y%m%d_%H%M%S.png' \
    -e 'mkdir -p ~/Pictures/screenshots && \
      mv $f ~/Pictures/screenshots && \
      xclip -selection clipboard -t image/png \
        -i ~/Pictures/screenshots/`ls -1 -t ~/Pictures/screenshots | head -1` \
      | notify-send "Saved $f" -t 1500' # Area selection

# vim-anywhere (https://github.com/cknadler/vim-anywhere)
bindsym Ctrl+Alt+v exec ~/.vim-anywhere/bin/run
bindsym $mod+Shift+v exec ~/.vim-anywhere/bin/run
# }}}
# ウィンドウ・コンテナ{{{
# ウィンドウの削除
bindsym $mod+Shift+q kill
bindsym Alt+F4 kill
bindsym $mod+q kill

# マウス設定 (参考: https://i3wm.org/docs/userguide.html#mousebindings)

# タイトルバーで中ボタンを押したらウィンドウ削除
bindsym --release button2 kill

# 右クリックでフローティングかどうかをトグル
# bindsym --border button3 exec "i3-msg floating toggle && i3-msg border normal"
# bindsym --border button3 exec "i3-msg floating toggle && i3-msg 'for_window[floating]' border normal && i3-msg 'for_window[tiling]' border pixel 3"

# 右クリックでフローティングに
# bindsym --border button3 exec "i3-msg floating enable && i3-msg border normal"
#
# 左クリックでフローティング解除
# bindsym --border button1 exec "i3-msg floating disable && i3-msg border pixel 3"
# bindsym --release button1 exec "i3-msg floating disable && i3-msg border pixel 3"

# マウスの中ボタンでウィンドウ削除
# bindsym button2 kill

# ウィンドウのフォーカス
bindsym $mod+h focus left
bindsym $mod+j focus down
bindsym $mod+k focus up
bindsym $mod+l focus right

bindsym $mod+Left focus left
bindsym $mod+Down focus down
bindsym $mod+Up focus up
bindsym $mod+Right focus right

# ウィンドウの移動
bindsym $mod+Shift+h move left
bindsym $mod+Shift+j move down
bindsym $mod+Shift+k move up
bindsym $mod+Shift+l move right

bindsym $mod+Shift+Left move left
bindsym $mod+Shift+Down move down
bindsym $mod+Shift+Up move up
bindsym $mod+Shift+Right move right

# ウィンドウの分割(水平 or 垂直)
bindsym $mod+c split h
bindsym $mod+v split v

# ウィンドウの最大化を切り替え
bindsym $mod+f fullscreen toggle

# コンテナのレイアウト
bindsym $mod+s layout stacking
bindsym $mod+w layout tabbed
bindsym $mod+e layout toggle split

# タイリング/フローティングの切り替え
bindsym $mod+Shift+space floating toggle

# タイリング/フローティングのフォーカス切り替え
bindsym $mod+space focus mode_toggle

# 親コンテナにフォーカス
bindsym $mod+a focus parent

# 子コンテナにフォーカス
#bindsym $mod+d focus child
# }}}
# ワークスペース{{{
# switch to workspace
bindsym $mod+1 workspace 1
bindsym $mod+2 workspace 2
bindsym $mod+3 workspace 3
bindsym $mod+4 workspace 4
bindsym $mod+5 workspace 5
bindsym $mod+6 workspace 6
bindsym $mod+7 workspace 7
bindsym $mod+8 workspace 8
bindsym $mod+9 workspace 9
bindsym $mod+0 workspace 10

# move focused container to workspace
bindsym $mod+Shift+1 move container to workspace 1; workspace 1
bindsym $mod+Shift+2 move container to workspace 2; workspace 2
bindsym $mod+Shift+3 move container to workspace 3; workspace 3
bindsym $mod+Shift+4 move container to workspace 4; workspace 4
bindsym $mod+Shift+5 move container to workspace 5; workspace 5
bindsym $mod+Shift+6 move container to workspace 6; workspace 6
bindsym $mod+Shift+7 move container to workspace 7; workspace 7
bindsym $mod+Shift+8 move container to workspace 8; workspace 8
bindsym $mod+Shift+9 move container to workspace 9; workspace 9
bindsym $mod+Shift+0 move container to workspace 10; workspace 10

# cycle between workspace
bindsym $mod+Tab workspace next
bindsym $mod+n workspace next
bindsym $mod+Shift+n move container to workspace next; workspace next
bindsym $mod+Shift+Tab workspace prev
bindsym $mod+p workspace prev
bindsym $mod+Shift+p move container to workspace prev; workspace prev

# Alt + Tabで切り替え。うまく動かない
bindsym Alt+Tab workspace back_and_forth

# mod + t でステータスバーの表示/非表示
bindsym $mod+t exec i3-msg bar mode toggle
# mod + m でもOK
bindsym $mod+m exec i3-msg bar mode toggle
# }}}
# リサイズ{{{
# resize window (you can also use the mouse for that)
mode "resize" {
        bindsym h resize shrink width 10 px or 10 ppt
        bindsym j resize grow height 10 px or 10 ppt
        bindsym k resize shrink height 10 px or 10 ppt
        bindsym l resize grow width 10 px or 10 ppt

        # same bindings, but for the arrow keys
        bindsym Left resize shrink width 10 px or 10 ppt
        bindsym Down resize grow height 10 px or 10 ppt
        bindsym Up resize shrink height 10 px or 10 ppt
        bindsym Right resize grow width 10 px or 10 ppt

        # back to normal: Enter or Escape
        bindsym Return mode "default"
        bindsym Escape mode "default"
}
bindsym $mod+r mode "resize"
# }}}
# }}}
# 表示{{{

# pywalの設定(参考 https://github.com/dylanaraps/pywal/wiki/Getting-Started)
# Set colors from Xresources
# Change 'color7' and 'color2' to whatever colors you want i3 to use 
# from the generated scheme.
# NOTE: The '#f0f0f0' in the lines below is the color i3 will use if
# it fails to get colors from Xresources.
set_from_resource $fg i3wm.color7 #f0f0f0
set_from_resource $bg i3wm.color2 #f0f0f0

# class                 border  backgr. text indicator child_border
client.focused          $bg     $bg     $fg  $bg       $bg
# client.focused_inactive $bg     $bg     $fg  $bg       $bg
# client.unfocused        $bg     $bg     $fg  $bg       $bg
# client.urgent           $bg     $bg     $fg  $bg       $bg
client.placeholder      $bg     $bg     $fg  $bg       $bg

client.background       $bg

# フォント
font pango:monospace 8

# ワークスペース0はフローティング用。GUIアプリ作成などに使用
for_window [workspace="0"] floating enable

# i3statusの設定
bar {
        colors {
        background #2f343f
        statusline #2f343f
        separator #4b5262

        # colour of border, background, and text
        focused_workspace       #2f343f #bf616a #d8dee8
        active_workspace        #2f343f #2f343f #d8dee8
        inactive_workspace      #2f343f #2f343f #d8dee8
        urgent_workspacei       #2f343f #ebcb8b #2f343f
    }
        status_command i3status
}

# Set inner/outer gaps
# ウィンドウに枠線をつける
for_window [class="^.*" tiling] border pixel 3
for_window [class="^.*" floating] border normal

# 壁紙設定
# exec --no-startup-id "feh --bg-scale ~/Pictures/hogehoge.png"

# 文字表示
exec --no-startup-id xsettingsd &

# ディスプレイ設定。arandrで設定を調べる
# display setting
workspace 2 output VGA-1
workspace 1 output HDMI-1
# exec --no-startup-id xrandr --output VGA-1 --auto --right-of HDMI-1, mode "default"

# arandr(xrandrのGUIでの設定)
exec xrandr --output LVDS-1 --off --output DP-1 --off --output HDMI-1 --mode 1920x1080 --pos 0x0 --rotate normal --output VGA-1 --mode 1920x1080 --pos 1920x0 --rotate normal
# }}}
# スタートアップ{{{
# ネットワーク情報を表示
exec --no-startup-id nm-applet
exec --no-startup-id dunst
exec --no-startup-id fcitx
exec --no-startup-id parcellite
# exec --no-startup-id volumeicon
# 音量調節はpasystrayを使う。aptで落とせる
# 注意：ミュートのトグルは対象で中ボタンクリックしなければいけない
exec --no-startup-id pasystray
# アプリで透明色を使えるようにする。comptonが必要
exec --no-startup-id compton -b
# 壁紙を設定するためのアプリ起動。fehとvarietyが必要
exec --no-startup-id variety
# exec --no-startup-id conky
# }}}
